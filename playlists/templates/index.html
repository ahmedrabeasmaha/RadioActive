{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Radio Active</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:200,300,400,700,900|Roboto+Mono:300,400,500"> 
        <link rel="stylesheet" href="{% static 'fonts/icomoon/style.css' %}">

        <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">
        <link rel="stylesheet" href="{% static 'css/jquery-ui.css' %}">
        <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.css' %}">
        <link rel="stylesheet" href="{% static 'css/mediaelementplayer.css' %}">
        <link rel="stylesheet" href="{% static 'css/animate.css' %}">
        <link rel="stylesheet" href="{% static 'fonts/flaticon/font/flaticon.css' %}">
        <link rel="stylesheet" href="{% static 'css/fl-bigmug-line.css' %}">

        <link rel="stylesheet" href="{% static 'css/all.css' %}">
        <link rel="stylesheet" href="{% static 'css/aos.css' %}">

        <link rel="stylesheet" href="{% static 'css/style.css' %}">
        <link rel="icon" href="{% static 'images/3.png' %}" sizes="32x32" type="image/png">
    </head>
    <body>
        <div class="site-wrap">
            <div class="site-navbar mt-4">
                <div class="container py-1">
                    <div class="row align-items-center justify-content-between">
                        <div class="col-8 col-md-8 col-lg-4">
                            <h1 class="mb-0"><a href="{% url 'home' %}" class="text-white h2 mb-0"><strong>Radio Active<span class="text-primary">.</span></strong></a></h1>
                        </div>
                        <div class="col-md-auto">
                            {% if user.is_authenticated %}
                            <form method="post">
                                {% csrf_token %}
                                <button name="logout" type="submit" class="btn" id="logout" style="background-color:transparent;"><i class="far fa-user fa-2x"></i><h1 style="display:inline;"><strong>Logout</strong></h1></button>
                            </form>
                            {% else %}
                            <nav class="navbar navbar-expand-lg navbar-light">
                                <div class="navbar-nav ml-auto">
                                    <div class="nav-item dropdown login-dropdown">
                                        <a href="" data-toggle="dropdown" class="nav-item nav-link dropdown-toggle"><i class="far fa-user fa-2x"></i><h1 style="display:inline;"><strong>Login</strong></h1></a>
                                        <div class="dropdown-menu">
                                            <form class="form-inline login-form" method="post">
                                                {% csrf_token %}
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <span class="fa fa-user"></span>
                                                        </span>                    
                                                    </div>
                                                    <input type="text" class="form-control" placeholder="Username" name="username" required>
                                                </div>
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fa fa-lock"></i>
                                                        </span>                    
                                                    </div>
                                                    <input type="password" class="form-control" placeholder="Password" name="password" required>
                                                </div>
                                                <button name="login" type="submit" class="btn btn-primary">Login</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </nav>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="site-mobile-menu">
            <div class="site-mobile-menu-header">
                <div class="site-mobile-menu-close mt-3">
                    <span class="icon-close2 js-menu-toggle"></span>
                </div>
            </div>
            <div class="site-mobile-menu-body"></div>
        </div>

        <div class="site-blocks-cover overlay plaplapla" data-aos="fade" data-stellar-background-ratio="0.5" data-aos="fade">
            <div class="container">
                <div class="row align-items-center justify-content-center">
                    <div class="col-md-7 text-center" data-aos="fade-up" data-aos-delay="400">
                        {% if user.is_authenticated %}
                        <h1>Listen &mdash; On-Air Now</h1>
                        <p class="mb-4"><span class="small">Powered by Radio Active</span></p>
                        <div id="playerContainer0">
                                <button name="playOrStop" class="btn" id="play"><img src="{% static 'images/play-button-svgrepo-com.svg' %}" width="100" height="100"></button>
                        </div>
                        <div id="playerContainer0">
                            <button name="skip" class="btn float-right" id="skip"><img src="{% static 'images/next-skip-svgrepo-com.svg' %}" width="100" height="100"></button>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-primary" data-aos="fade">
            <div class="container">
                <div class="row">
                    <a href="#" class="col-4 text-center py-4 social-icon d-block"><span class="icon-facebook text-white"></span></a>
                    <a href="#" class="col-4 text-center py-4 social-icon d-block"><span class="icon-twitter text-white"></span></a>
                    <a href="#" class="col-4 text-center py-4 social-icon d-block"><span class="icon-instagram text-white"></span></a>
                </div>
            </div>
        </div>

        <footer class="site-footer">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <div class="mb-5">
                            <h3 class="footer-heading mb-4">About Radio</h3>
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Saepe pariatur reprehenderit vero atque, consequatur id ratione, et non dignissimos culpa? Ut veritatis, quos illum totam quis blanditiis, minima minus odio!</p>
                        </div>
                        <div class="row justify-content-center">
                            <div class="col-md-auto">
                                <h3 class="footer-heading mb-4">Follow Us</h3>
                                <div>
                                    <a href="#" class="pl-0 pr-3"><span class="icon-facebook"></span></a>
                                    <a href="#" class="pl-3 pr-3"><span class="icon-twitter"></span></a>
                                    <a href="#" class="pl-3 pr-3"><span class="icon-instagram"></span></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row pt-5 mt-5 text-center">
                    <div class="col-md-12">
                        <div id="ahmed"></div>
                        <p>Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart text-danger" aria-hidden="true"></i> by <a href="https://www.facebook.com/radio.active2020" target="_blank">Radio Active</a></p>
                    </div>
                </div>
            </div>
        </footer>
        <script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
        <script src="{% static 'js/jquery-migrate-3.0.1.min.js' %}"></script>
        <script src="{% static 'js/jquery-ui.js' %}"></script>
        <script src="{% static 'js/popper.min.js' %}"></script>
        <script src="{% static 'js/bootstrap.min.js' %}"></script>
        <script src="{% static 'js/owl.carousel.min.js' %}"></script>
        <script src="{% static 'js/mediaelement-and-player.min.js' %}"></script>
        <script src="{% static 'js/jquery.stellar.min.js' %}"></script>
        <script src="{% static 'js/jquery.countdown.min.js' %}"></script>
        <script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
        <script src="{% static 'js/bootstrap-datepicker.min.js' %}"></script>
        <script src="{% static 'js/aos.js' %}"></script>
        <script src="{% static 'js/circleaudioplayer.js' %}"></script>
        <script src="{% static 'js/jquery-3.5.1.js' %}"></script>
        <script src="{% static 'js/main.js' %}"></script>
        {% if user.is_authenticated %}
        <script type="text/javascript">
            var song = new Audio();
            window.onload = ad;
            
            function ad () {
                x = 0;
                adNum = 0;
                adin = 0;
                $.ajax({
                    url: "{% url 'adnum' %}",
                    data: {},
                    success: function (data) {
                        adNum = data;
                    }
                });
            }
            $("#play").click(function () {
                if (x != 3 && x != 4) {
                    if(song.paused){
                        $.ajax({
                            url: "{% url 'play' %}",
                            data: {},
                            success: function (dadata) {
                                song.src = "{% get_media_prefix %}" + dadata[0]['fields']['music'];
                                song.play();
                                $("#play img").attr("src","{% static 'images/stop-svgrepo-com.svg' %}");
                            }
                        });
                        
                    }
                    else{
                        song.pause();
                        song.currentTime = 0;
                        $("#play img").attr("src","{% static 'images/play-button-svgrepo-com.svg' %}");
                    }
                }
            }); 
            $("#skip").click(function() {
                if (song.currentTime > song.duration / 2) {
                    x += 1;
                }
                if (x == 3) {
                    if (adin == adNum) {
                        adin = 0;
                    }
                    $.ajax({
                        url: "{% url 'ad' %}",
                        data: {
                            'mui': adin,
                        },
                        success: function (data) {
                            song.src = "{% get_media_prefix %}" + data;
                            song.play();
                            $("#play img").attr("src","{% static 'images/stop-svgrepo-com.svg' %}");
                            adin += 1
                        }
                    });
                    x += 1;
                }
                else if (x != 4 && x != 3) {
                    var mui = song.src.replace('http://127.0.0.1:8000/media/', '');
                    $.ajax({
                        url: "{% url 'end' %}",
                        data: {
                            'mui': mui,
                        },
                        success: function (data) {
                            song.src = "{% get_media_prefix %}" + data[0]['fields']['music'];
                            song.play();
                            $("#play img").attr("src","{% static 'images/stop-svgrepo-com.svg' %}");
                        }
                    });
                }
            });
            song.addEventListener('ended', function () {
                if (x == 4) {
                    x = 0;
                    $.ajax({
                            url: "{% url 'play' %}",
                            data: {},
                            success: function (dadata) {
                                song.src = "{% get_media_prefix %}" + dadata[0]['fields']['music'];
                                song.play();
                                $("#play img").attr("src","{% static 'images/stop-svgrepo-com.svg' %}");
                            }
                        });
                }
                else if (x == 3) {
                    if (adin == adNum) {
                        adin = 0;
                    }
                    $.ajax({
                        url: "{% url 'ad' %}",
                        data: {
                            'mui': adin,
                        },
                        success: function (data) {
                            song.src = "{% get_media_prefix %}" + data;
                            song.play();
                            $("#play img").attr("src","{% static 'images/stop-svgrepo-com.svg' %}");
                            adin += 1
                        }
                    });
                    x += 4;
                }
                else {
                    x += 1;
                    var mui = song.src.replace('http://127.0.0.1:8000/media/', '');
                    $.ajax({
                        url: "{% url 'end' %}",
                        data: {
                            'mui': mui,
                        },
                        success: function (data) {
                            song.src = "{% get_media_prefix %}" + data[0]['fields']['music'];
                            song.play();
                            $("#play img").attr("src","{% static 'images/stop-svgrepo-com.svg' %}");
                        }
                    });
                }
            });

            // function playOrPauseSong(){
            //     if(song.paused){
            //         song.play();
            //         $("#play img").attr("src","{% static 'images/stop-svgrepo-com.svg' %}");
            //     }
            //     else{
            //         song.pause();
            //         song.currentTime = 0;
            //         $("#play img").attr("src","{% static 'images/play-button-svgrepo-com.svg' %}");
            //     }
            // }
        </script>
        {% endif %}
    </body>
</html>